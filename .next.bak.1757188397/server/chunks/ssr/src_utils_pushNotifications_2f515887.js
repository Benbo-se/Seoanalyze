module.exports=[27476,a=>{"use strict";async function b(){if(!("Notification"in window))return console.warn("This browser does not support notifications"),"denied";if("granted"===Notification.permission)return"granted";if("denied"===Notification.permission)return"denied";let a=await Notification.requestPermission();return console.log("Notification permission:",a),a}async function c(a){try{let c=await b();if("granted"!==c)return console.warn("Notification permission not granted"),null;let d=await a.pushManager.getSubscription();if(d)return console.log("Already subscribed to push notifications"),d;let f=function(a){let b="=".repeat((4-a.length%4)%4),c=(a+b).replace(/-/g,"+").replace(/_/g,"/"),d=window.atob(c),e=new Uint8Array(d.length);for(let a=0;a<d.length;++a)e[a]=d.charCodeAt(a);return e}("BEffMaVuuKK12Yl5mulPU99ZShnk-0l_gbOuNVtidI0zOQsxJNQFQsP4vTfYHkUqTswmvOMfAscLZf5NkrPTgmk"),g=await a.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:f});return console.log("Successfully subscribed to push notifications:",g),await e(g),g}catch(a){return console.error("Failed to subscribe to push notifications:",a),null}}async function d(a){try{let b=await a.pushManager.getSubscription();if(!b)return console.log("No subscription found"),!0;let c=await b.unsubscribe();return c&&(console.log("Successfully unsubscribed from push notifications"),await f(b)),c}catch(a){return console.error("Failed to unsubscribe from push notifications:",a),!1}}async function e(a){try{(await fetch("/api/push/subscribe",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({subscription:a,timestamp:Date.now()})})).ok||console.warn("Failed to save subscription to server")}catch(a){console.error("Error sending subscription to server:",a)}}async function f(a){try{(await fetch("/api/push/unsubscribe",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({subscription:a})})).ok||console.warn("Failed to remove subscription from server")}catch(a){console.error("Error removing subscription from server:",a)}}async function g(a,b,c,d){if(!("Notification"in window)||"granted"!==Notification.permission)return;let e=new Notification("Analys komplett!",{body:`Din ${b.toUpperCase()}-analys av ${c} \xe4r klar. Score: ${d}`,icon:"/icons/icon-192x192.png",badge:"/icons/icon-72x72.png",vibrate:[200,100,200],data:{jobId:a,analysisType:b,url:c,score:d},actions:[{action:"view",title:"Visa resultat"}],requireInteraction:!0,tag:"analysis-complete"});e.addEventListener("click",()=>{window.focus(),window.location.href=`/analys/${a}`,e.close()}),setTimeout(()=>{e.close()},1e4)}async function h(a){if(!("serviceWorker"in navigator)||!navigator.serviceWorker.controller)return console.warn("Service Worker not available for background sync"),null;try{let b=new MessageChannel;return new Promise((c,d)=>{b.port1.onmessage=a=>{a.data.success?c(a.data.analysisId):d(Error("Failed to queue analysis"))},navigator.serviceWorker.controller.postMessage({type:"QUEUE_ANALYSIS",analysisData:a,analysisId:Date.now().toString()},[b.port2])})}catch(a){return console.error("Error queuing analysis for background sync:",a),null}}async function i(){let a="Notification"in window&&"serviceWorker"in navigator&&"PushManager"in window;if(!a)return{supported:!1,permission:"denied",subscribed:!1};let b=Notification.permission,c=!1;try{let a=await navigator.serviceWorker.ready;c=!!await a.pushManager.getSubscription()}catch(a){console.error("Error checking subscription status:",a)}return{supported:a,permission:b,subscribed:c}}a.s(["getPushNotificationStatus",()=>i,"queueAnalysisForBackgroundSync",()=>h,"requestNotificationPermission",()=>b,"showAnalysisCompleteNotification",()=>g,"subscribeToPushNotifications",()=>c,"unsubscribeFromPushNotifications",()=>d])}];

//# sourceMappingURL=src_utils_pushNotifications_2f515887.js.map
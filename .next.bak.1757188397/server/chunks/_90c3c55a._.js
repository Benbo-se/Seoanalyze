module.exports=[48055,(e,t,a)=>{let r=e.r(22734).promises,n=e.r(14747);t.exports=new class{constructor(){this.logDir=process.env.ANALYTICS_LOG_DIR||"./logs",this.initialized=!1,this.bufferSize=100,this.logBuffer=[],this.flushInterval=3e4,this.eventTypes={API_CALL:"api_call",ANALYSIS_START:"analysis_start",ANALYSIS_COMPLETE:"analysis_complete",ERROR:"error",PERFORMANCE:"performance",USER_ACTION:"user_action",SYSTEM_METRIC:"system_metric",RATE_LIMIT:"rate_limit",CIRCUIT_BREAKER:"circuit_breaker"}}async initialize(){if(!this.initialized)try{await r.mkdir(this.logDir,{recursive:!0}),console.log(`ðŸ“Š Analytics Logger initialized at ${this.logDir}`),setInterval(()=>this.flushBuffer(),this.flushInterval),process.on("beforeExit",()=>this.flushBuffer()),process.on("SIGINT",()=>this.flushBuffer()),process.on("SIGTERM",()=>this.flushBuffer()),this.initialized=!0}catch(e){console.error("Failed to initialize Analytics Logger:",e)}}async logApiCall(e,t,a,r,n={}){await this.log(this.eventTypes.API_CALL,{endpoint:e,method:t,statusCode:a,duration:r,success:a<400,...n})}async logAnalysisStart(e,t,a,r={}){await this.log(this.eventTypes.ANALYSIS_START,{analysisId:e,url:t,type:a,...r})}async logAnalysisComplete(e,t,a,r,n,s={}){await this.log(this.eventTypes.ANALYSIS_COMPLETE,{analysisId:e,url:t,type:a,duration:r,success:n,resultsCount:s.count||0,errorCount:s.errors||0,...s})}async logError(e,t={}){await this.log(this.eventTypes.ERROR,{message:e.message,stack:e.stack,name:e.name,...t})}async logPerformance(e,t,a="ms",r={}){await this.log(this.eventTypes.PERFORMANCE,{metric:e,value:t,unit:a,...r})}async logUserAction(e,t=null,a={}){await this.log(this.eventTypes.USER_ACTION,{action:e,userId:t,...a})}async logSystemMetric(e,t,a={}){await this.log(this.eventTypes.SYSTEM_METRIC,{name:e,value:t,...a})}async logRateLimit(e,t,a,r=null){await this.log(this.eventTypes.RATE_LIMIT,{domain:e,allowed:t,tokens:a,retryAfter:r})}async logCircuitBreaker(e,t,a,r={}){await this.log(this.eventTypes.CIRCUIT_BREAKER,{service:e,state:t,action:a,...r})}async log(t,a){this.initialized||await this.initialize();let r={timestamp:new Date().toISOString(),eventType:t,data:{...a,environment:"production",pid:process.pid,hostname:e.r(46786).hostname()}};this.logBuffer.push(r),this.logBuffer.length>=this.bufferSize&&await this.flushBuffer()}async flushBuffer(){if(0!==this.logBuffer.length)try{let e=new Date().toISOString().split("T")[0],t=n.join(this.logDir,`analytics-${e}.jsonl`),a=this.logBuffer.splice(0),s=a.map(e=>JSON.stringify(e)).join("\n")+"\n";await r.appendFile(t,s,"utf8"),a.length>0&&console.log(`ðŸ“ Flushed ${a.length} analytics entries to ${t}`)}catch(e){console.error("Failed to flush analytics buffer:",e),this.logBuffer.unshift(...entries)}}consoleLog(e,t){let a={[this.eventTypes.API_CALL]:t.success?"âœ…":"âŒ",[this.eventTypes.ANALYSIS_START]:"ðŸš€",[this.eventTypes.ANALYSIS_COMPLETE]:"âœ¨",[this.eventTypes.ERROR]:"ðŸš¨",[this.eventTypes.PERFORMANCE]:"âš¡",[this.eventTypes.USER_ACTION]:"ðŸ‘¤",[this.eventTypes.SYSTEM_METRIC]:"ðŸ“Š",[this.eventTypes.RATE_LIMIT]:t.allowed?"ðŸŸ¢":"ðŸ”´",[this.eventTypes.CIRCUIT_BREAKER]:"ðŸ›¡ï¸"};console.log(`${a[e]||"ðŸ“"} [${e}]`,JSON.stringify(t,null,0))}async getAnalytics(e=null,t=null){try{let a=e||new Date().toISOString().split("T")[0],s=n.join(this.logDir,`analytics-${a}.jsonl`);try{let e=(await r.readFile(s,"utf8")).trim().split("\n").filter(e=>e).map(e=>JSON.parse(e)),n=t?e.filter(e=>e.eventType===t):e;return{date:a,totalEntries:n.length,entries:n,summary:this.generateSummary(n)}}catch(e){return{date:a,totalEntries:0,entries:[],error:`No analytics data found for ${a}`}}}catch(e){throw Error(`Failed to read analytics: ${e.message}`)}}generateSummary(e){let t={byEventType:{},timeRange:{start:null,end:null},performance:{apiCalls:{total:0,successful:0,failed:0,avgDuration:0}}};if(0===e.length)return t;e.forEach(e=>{let a=e.eventType;t.byEventType[a]=(t.byEventType[a]||0)+1});let a=e.map(e=>new Date(e.timestamp));t.timeRange.start=new Date(Math.min(...a)).toISOString(),t.timeRange.end=new Date(Math.max(...a)).toISOString();let r=e.filter(e=>e.eventType===this.eventTypes.API_CALL);if(r.length>0){t.performance.apiCalls.total=r.length,t.performance.apiCalls.successful=r.filter(e=>e.data.success).length,t.performance.apiCalls.failed=r.filter(e=>!e.data.success).length;let e=r.map(e=>e.data.duration).filter(e=>e);e.length>0&&(t.performance.apiCalls.avgDuration=Math.round(e.reduce((e,t)=>e+t,0)/e.length))}return t}async cleanup(e=30){try{let t=(await r.readdir(this.logDir)).filter(e=>e.startsWith("analytics-")&&e.endsWith(".jsonl")),a=new Date;for(let s of(a.setDate(a.getDate()-e),t)){let e=s.match(/analytics-(\d{4}-\d{2}-\d{2})\.jsonl/);e&&new Date(e[1])<a&&(await r.unlink(n.join(this.logDir,s)),console.log(`ðŸ—‘ï¸ Cleaned up old analytics file: ${s}`))}}catch(e){console.error("Analytics cleanup failed:",e)}}}},93405,e=>{"use strict";e.s(["handler",()=>N,"patchFetch",()=>x,"routeModule",()=>C,"serverHooks",()=>I,"workAsyncStorage",()=>_,"workUnitAsyncStorage",()=>M],93405);var t=e.i(47909),a=e.i(74017),r=e.i(96250),n=e.i(59756),s=e.i(61916),i=e.i(69741),o=e.i(16795),l=e.i(87718),c=e.i(73895),u=e.i(47587),p=e.i(66012),d=e.i(70101),h=e.i(26937),g=e.i(10372),f=e.i(93695);e.i(52474);var m=e.i(220);e.s(["DELETE",()=>w,"GET",()=>T,"POST",()=>E,"runtime",()=>v],82856);var y=e.i(89171);let R=e.r(48055),v="nodejs";async function T(e){try{let{searchParams:t}=new URL(e.url),a=t.get("date"),r=t.get("eventType");if("true"===t.get("demo"))return await A(),y.NextResponse.json({success:!0,message:"Demo analytics data generated",endpoints:{current:"/api/analytics-v2",withDate:"/api/analytics-v2?date=2025-09-04",byType:"/api/analytics-v2?eventType=api_call"}});let n=await R.getAnalytics(a,r),s=function(e){if(!e||0===e.length)return{summary:"Ingen data tillgÃ¤nglig fÃ¶r analys",recommendations:[]};let t={traffic:{totalRequests:0,uniqueEndpoints:new Set,peakHours:{},errorRate:0},performance:{avgResponseTime:0,slowestEndpoints:[],performanceIssues:[]},users:{totalActions:0,topActions:{},conversionRate:0},recommendations:[]},a=e.filter(e=>"api_call"===e.eventType),r=e.filter(e=>"user_action"===e.eventType);if(e.filter(e=>"performance"===e.eventType),a.length>0){t.traffic.totalRequests=a.length,t.traffic.uniqueEndpoints=new Set(a.map(e=>e.data.endpoint));let e=a.filter(e=>!e.data.success).length;t.traffic.errorRate=Math.round(e/a.length*100),a.forEach(e=>{let a=new Date(e.timestamp).getHours();t.traffic.peakHours[a]=(t.traffic.peakHours[a]||0)+1})}if(a.length>0){let e=a.map(e=>e.data.duration).filter(e=>e);if(e.length>0){t.performance.avgResponseTime=Math.round(e.reduce((e,t)=>e+t,0)/e.length);let r={};a.forEach(e=>{if(e.data.duration){let t=e.data.endpoint;r[t]||(r[t]=[]),r[t].push(e.data.duration)}}),t.performance.slowestEndpoints=Object.entries(r).map(([e,t])=>({endpoint:e,avgTime:Math.round(t.reduce((e,t)=>e+t)/t.length),calls:t.length})).sort((e,t)=>t.avgTime-e.avgTime).slice(0,3)}}return t.users.totalActions=r.length,r.length>0&&r.forEach(e=>{let a=e.data.action;t.users.topActions[a]=(t.users.topActions[a]||0)+1}),t.traffic.errorRate>10&&t.recommendations.push({type:"error_rate",priority:"high",message:`H\xf6g error rate (${t.traffic.errorRate}%). Unders\xf6k failing endpoints.`}),t.performance.avgResponseTime>1e3&&t.recommendations.push({type:"performance",priority:"medium",message:`H\xf6g genomsnittlig response tid (${t.performance.avgResponseTime}ms). \xd6verv\xe4g caching eller optimering.`}),t.traffic.totalRequests>1e3&&t.recommendations.push({type:"scaling",priority:"low",message:"HÃ¶gt request-volym. Ã–vervÃ¤g horisontell skalning och load balancing."}),t}(n.entries);return y.NextResponse.json({success:!0,analytics:n,insights:s,meta:{requestedDate:a||"today",eventType:r||"all",generatedAt:new Date().toISOString()}})}catch(e){return console.error("Analytics API error:",e),y.NextResponse.json({error:"Misslyckades att hÃ¤mta analytics data",message:e.message},{status:500})}}async function E(e){try{let t=await e.json().catch(()=>null);if(!t?.eventType||!t?.data)return y.NextResponse.json({error:"eventType och data krÃ¤vs"},{status:400});let{eventType:a,data:r,userId:n=null}=t,s=["api_call","analysis_start","analysis_complete","error","performance","user_action","system_metric"];if(!s.includes(a))return y.NextResponse.json({error:`Ogiltigt eventType. Giltiga typer: ${s.join(", ")}`},{status:400});switch(a){case"api_call":await R.logApiCall(r.endpoint,r.method,r.statusCode,r.duration,{userId:n,...r.metadata});break;case"user_action":await R.logUserAction(r.action,n,r);break;case"performance":await R.logPerformance(r.metric,r.value,r.unit||"ms",{userId:n,...r.metadata});break;default:await R.log(a,{userId:n,...r})}return console.log(`ðŸ“Š Analytics event logged: ${a}`),y.NextResponse.json({success:!0,message:`Analytics event '${a}' loggad`,eventType:a,timestamp:new Date().toISOString()})}catch(e){return console.error("Analytics logging error:",e),y.NextResponse.json({error:"Misslyckades att logga analytics event",message:e.message},{status:500})}}async function A(){let e=["/api/analyze","/api/lighthouse","/api/crawl","/api/rum"],t=["GET","POST"],a=[200,200,200,201,400,404,500];for(let r=0;r<20;r++){let r=e[Math.floor(Math.random()*e.length)],n=t[Math.floor(Math.random()*t.length)],s=a[Math.floor(Math.random()*a.length)],i=Math.floor(2e3*Math.random())+50;await R.logApiCall(r,n,s,i,{userAgent:"Mozilla/5.0 (Test Browser)",ip:`192.168.1.${Math.floor(255*Math.random())}`})}for(let e=0;e<5;e++){let t=`demo_${Date.now()}_${e}`,a=`https://example${e}.com`,r=["lighthouse","crawl"][Math.floor(2*Math.random())];await R.logAnalysisStart(t,a,r,{source:"demo"}),setTimeout(async()=>{let e=Math.floor(3e4*Math.random())+5e3,n=Math.random()>.1;await R.logAnalysisComplete(t,a,r,e,n,{count:n?Math.floor(50*Math.random())+10:0})},1e3*Math.random())}for(let e of["memory_usage","cpu_usage","response_time","queue_length"])await R.logSystemMetric(e,Math.floor(100*Math.random()));let r=["page_view","button_click","form_submit","download_report"];for(let e=0;e<10;e++){let t=r[Math.floor(Math.random()*r.length)];await R.logUserAction(t,`user_${e}`,{page:"/",source:"demo"})}}async function w(e){try{let{searchParams:t}=new URL(e.url),a=parseInt(t.get("daysToKeep")||"30");return await R.cleanup(a),y.NextResponse.json({success:!0,message:`Analytics cleanup slutf\xf6rd. Beh\xe5ller ${a} dagars data.`,timestamp:new Date().toISOString()})}catch(e){return console.error("Analytics cleanup error:",e),y.NextResponse.json({error:"Misslyckades att rensa analytics data",message:e.message},{status:500})}}var S=e.i(82856);let C=new t.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/analytics-v2/route",pathname:"/api/analytics-v2",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/src/app/api/analytics-v2/route.js",nextConfigOutput:"standalone",userland:S}),{workAsyncStorage:_,workUnitAsyncStorage:M,serverHooks:I}=C;function x(){return(0,r.patchFetch)({workAsyncStorage:_,workUnitAsyncStorage:M})}async function N(e,t,r){var y;let R="/api/analytics-v2/route";R=R.replace(/\/index$/,"")||"/";let v=await C.prepare(e,t,{srcPage:R,multiZoneDraftMode:!1});if(!v)return t.statusCode=400,t.end("Bad Request"),null==r.waitUntil||r.waitUntil.call(r,Promise.resolve()),null;let{buildId:T,params:E,nextConfig:A,isDraftMode:w,prerenderManifest:S,routerServerContext:_,isOnDemandRevalidate:M,revalidateOnlyGenerated:I,resolvedPathname:x}=v,N=(0,i.normalizeAppPath)(R),O=!!(S.dynamicRoutes[N]||S.routes[x]);if(O&&!w){let e=!!S.routes[x],t=S.dynamicRoutes[N];if(t&&!1===t.fallback&&!e)throw new f.NoFallbackError}let D=null;!O||C.isDev||w||(D="/index"===(D=x)?"/":D);let P=!0===C.isDev||!O,b=O&&!P,L=e.method||"GET",k=(0,s.getTracer)(),$=k.getActiveScopeSpan(),j={params:E,prerenderManifest:S,renderOpts:{experimental:{cacheComponents:!!A.experimental.cacheComponents,authInterrupts:!!A.experimental.authInterrupts},supportsDynamicResponse:P,incrementalCache:(0,n.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:null==(y=A.experimental)?void 0:y.cacheLife,isRevalidate:b,waitUntil:r.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,a,r)=>C.onRequestError(e,t,r,_)},sharedContext:{buildId:T}},U=new o.NodeNextRequest(e),H=new o.NodeNextResponse(t),B=l.NextRequestAdapter.fromNodeNextRequest(U,(0,l.signalFromNodeResponse)(t));try{let i=async a=>C.handle(B,j).finally(()=>{if(!a)return;a.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=k.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==c.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let n=r.get("next.route");if(n){let e=`${L} ${n}`;a.setAttributes({"next.route":n,"http.route":n,"next.span_name":e}),a.updateName(e)}else a.updateName(`${L} ${e.url}`)}),o=async s=>{var o,l;let c=async({previousCacheEntry:a})=>{try{if(!(0,n.getRequestMeta)(e,"minimalMode")&&M&&I&&!a)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let o=await i(s);e.fetchMetrics=j.renderOpts.fetchMetrics;let l=j.renderOpts.pendingWaitUntil;l&&r.waitUntil&&(r.waitUntil(l),l=void 0);let c=j.renderOpts.collectedTags;if(!O)return await (0,p.sendResponse)(U,H,o,j.renderOpts.pendingWaitUntil),null;{let e=await o.blob(),t=(0,d.toNodeOutgoingHttpHeaders)(o.headers);c&&(t[g.NEXT_CACHE_TAGS_HEADER]=c),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let a=void 0!==j.renderOpts.collectedRevalidate&&!(j.renderOpts.collectedRevalidate>=g.INFINITE_CACHE)&&j.renderOpts.collectedRevalidate,r=void 0===j.renderOpts.collectedExpire||j.renderOpts.collectedExpire>=g.INFINITE_CACHE?void 0:j.renderOpts.collectedExpire;return{value:{kind:m.CachedRouteKind.APP_ROUTE,status:o.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:a,expire:r}}}}catch(t){throw(null==a?void 0:a.isStale)&&await C.onRequestError(e,t,{routerKind:"App Router",routePath:R,routeType:"route",revalidateReason:(0,u.getRevalidateReason)({isRevalidate:b,isOnDemandRevalidate:M})},_),t}},f=await C.handleResponse({req:e,nextConfig:A,cacheKey:D,routeKind:a.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:S,isRoutePPREnabled:!1,isOnDemandRevalidate:M,revalidateOnlyGenerated:I,responseGenerator:c,waitUntil:r.waitUntil});if(!O)return null;if((null==f||null==(o=f.value)?void 0:o.kind)!==m.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==f||null==(l=f.value)?void 0:l.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});(0,n.getRequestMeta)(e,"minimalMode")||t.setHeader("x-nextjs-cache",M?"REVALIDATED":f.isMiss?"MISS":f.isStale?"STALE":"HIT"),w&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let y=(0,d.fromNodeOutgoingHttpHeaders)(f.value.headers);return(0,n.getRequestMeta)(e,"minimalMode")&&O||y.delete(g.NEXT_CACHE_TAGS_HEADER),!f.cacheControl||t.getHeader("Cache-Control")||y.get("Cache-Control")||y.set("Cache-Control",(0,h.getCacheControlHeader)(f.cacheControl)),await (0,p.sendResponse)(U,H,new Response(f.value.body,{headers:y,status:f.value.status||200})),null};$?await o($):await k.withPropagatedContext(e.headers,()=>k.trace(c.BaseServerSpan.handleRequest,{spanName:`${L} ${e.url}`,kind:s.SpanKind.SERVER,attributes:{"http.method":L,"http.target":e.url}},o))}catch(t){if($||t instanceof f.NoFallbackError||await C.onRequestError(e,t,{routerKind:"App Router",routePath:N,routeType:"route",revalidateReason:(0,u.getRevalidateReason)({isRevalidate:b,isOnDemandRevalidate:M})}),O)throw t;return await (0,p.sendResponse)(U,H,new Response(null,{status:500})),null}}}];

//# sourceMappingURL=_90c3c55a._.js.map